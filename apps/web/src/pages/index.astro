---
import { Image } from 'astro:assets'
import { Array, DateTime, Effect, Exit, Match } from 'effect'

import silly from '~/content/silly.png'
import Layout from '~/Layout.astro'
import * as Post from '~/lib/Post'
import { Runtime } from '~/lib/Runtime'

const getPosts = Effect.gen(function* () {
  const postService = yield* Post.Service
  return yield* postService.list()
})

const result = await Runtime.runPromiseExit(getPosts)

const posts = Exit.isFailure(result) ? [] : result.value

const projects = [
  {
    name: 'repo.vercel.app',
    href: 'https://repo.vercel.app',
    description: 'Find the repo for any npm package',
  },
  {
    name: 'fthrsn',
    href: 'https://fthrsn.bandcamp.com',
    description: 'Music project from 2011-2013',
  },
] as const

const social = [
  {
    name: 'GitHub',
    href: 'https://github.com/macklinu',
  },
  {
    name: 'Twitter',
    href: 'https://twitter.com/macklinu',
  },
  {
    name: 'LinkedIn',
    href: 'https://www.linkedin.com/in/macklinu/',
  },
] as const
---

<Layout>
  <div class='space-y-8 pb-8'>
    <div class='flex flex-row items-center'>
      <div class='bg-slate-950 bg-blend-overlay'>
        <Image transition:name='mackie' src={silly} alt='' height={256} />
      </div>
      <p class='-ml-8 mt-8 text-xs sm:text-sm md:-ml-4'>
        Detroit-based software engineer<br />and musician
      </p>
    </div>
    <section class='space-y-4'>
      <p>Find me on:</p>
      <ul class='list-inside list-disc'>
        {
          social.map(({ name, href }) => (
            <li>
              <a
                href={href}
                target='_blank'
                rel='noreferrer noopener'
                aria-label={name}
                class='underline'
              >
                {name}
              </a>
            </li>
          ))
        }
      </ul>
    </section>
    <section>
      <h2 class='font-bold'>Posts</h2>
      <ul class='mt-4 list-none space-y-4'>
        {
          posts.map((post) => (
            <li class='flex flex-col gap-2 md:flex-row md:items-center'>
              <time
                datetime={DateTime.formatIsoDate(post.publicationDate)}
                class='text-sm tabular-nums text-slate-600 dark:text-slate-300'
                transition:name={`post-${post.id}--date`}
              >
                {DateTime.formatIsoDate(post.publicationDate)}
              </time>

              <a
                class='underline'
                href={`/posts/${post.slug}`}
                transition:name={`post-${post.id}--title`}
              >
                {post.title}
              </a>
            </li>
          ))
        }
      </ul>
    </section>
    <section>
      <h2 class='font-bold'>Projects</h2>
      <ul class='mt-4 list-none space-y-2'>
        {
          projects.map(({ name, description, href }) => (
            <li>
              <a
                class='underline'
                href={href}
                target='_blank'
                rel='noopener noreferrer'
              >
                {name}
              </a>

              <p class='text-slate-600 dark:text-slate-300'>{description}</p>
            </li>
          ))
        }
      </ul>
    </section>
  </div>
</Layout>
